<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>èªéŸ³æºé€šè¨“ç·´å®¤ï½œæ¯æ—¥ 1 åˆ†é˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f5f5f7;
      --card: #ffffff;
      --accent: #ffb347;
      --accent2: #8f9bff;
      --accent3: #ff8fab;
      --accent4: #6dd3c8;
      --text-main: #222;
      --text-sub: #666;
      --radius: 18px;
      --shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "PingFang TC", "Noto Sans TC", sans-serif;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at top, #fdf7ff, #f5f5f7);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 24px 12px 40px;
      color: var(--text-main);
    }

    .app {
      width: 100%;
      max-width: 840px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 24px;
      box-shadow: var(--shadow);
      padding: 20px 20px 24px;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .title-block h1 {
      font-size: 20px;
      margin: 0;
    }

    .title-block p {
      margin: 4px 0 0;
      font-size: 13px;
      color: var(--text-sub);
    }

    .link-back {
      font-size: 13px;
      color: var(--accent2);
      text-decoration: none;
      padding: 6px 10px;
      border-radius: 99px;
      border: 1px solid rgba(143, 155, 255, 0.4);
      background: rgba(143, 155, 255, 0.06);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      white-space: nowrap;
    }

    .tabs {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
      margin: 10px 0 16px;
    }

    .tab-btn {
      border: none;
      border-radius: 999px;
      padding: 10px 8px;
      font-size: 13px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      background: #f2f2f6;
      color: var(--text-sub);
      transition: all 0.18s ease;
    }

    .tab-btn span.emoji {
      font-size: 16px;
    }

    .tab-btn.active {
      color: #fff;
      background: linear-gradient(135deg, #ffb347, #ff8fab);
      box-shadow: 0 9px 22px rgba(255, 151, 133, 0.4);
      transform: translateY(-1px);
    }

    .tab-btn[data-mode="tongue"]      { background: #fff5e6; }
    .tab-btn[data-mode="story"]       { background: #edf2ff; }
    .tab-btn[data-mode="logic"]       { background: #ffe9f1; }
    .tab-btn[data-mode="free"]        { background: #e7faf5; }
    .tab-btn.active[data-mode="tongue"] { background: linear-gradient(135deg, #ffb347, #ffcf6b); }
    .tab-btn.active[data-mode="story"]  { background: linear-gradient(135deg, #8f9bff, #b9c1ff); }
    .tab-btn.active[data-mode="logic"]  { background: linear-gradient(135deg, #ff8fab, #ffb3c9); }
    .tab-btn.active[data-mode="free"]   { background: linear-gradient(135deg, #6dd3c8, #9ce5db); }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 18px 16px 16px;
      box-shadow: var(--shadow);
    }

    .label {
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--text-sub);
      margin-bottom: 6px;
    }

    .prompt-text {
      font-size: 16px;
      line-height: 1.6;
      margin: 4px 0 10px;
    }

    .mini-hint {
      font-size: 12px;
      color: var(--text-sub);
      margin: 0 0 6px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .btn {
      border-radius: 999px;
      border: none;
      font-size: 13px;
      padding: 8px 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      background: #f2f2f6;
      color: var(--text-main);
      transition: all 0.15s ease;
    }

    .btn.primary {
      background: #111827;
      color: #fff;
    }

    .btn.ghost {
      background: #ffffff;
      border: 1px solid #e5e7eb;
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    textarea {
      width: 100%;
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      padding: 10px 12px;
      font-size: 13px;
      resize: vertical;
      min-height: 76px;
      line-height: 1.5;
    }

    .score-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-top: 10px;
    }

    .score-item {
      background: #f9fafb;
      border-radius: 12px;
      padding: 8px 9px;
      font-size: 11px;
    }

    .score-item label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
      color: var(--text-sub);
    }

    .score-item input[type="range"] {
      width: 100%;
    }

    .footer-note {
      margin-top: 10px;
      font-size: 11px;
      color: var(--text-sub);
      text-align: right;
    }

    @media (max-width: 640px) {
      .app {
        padding: 16px 14px 20px;
      }
      .tabs {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="top-bar">
      <div class="title-block">
        <h1>èªéŸ³æºé€šè¨“ç·´å®¤</h1>
        <p>ç”¨è²éŸ³ç·´ç¿’ã€Œèªªæ¸…æ¥šã€è¬›åˆ°é»ã€å¸¶è‘—æº«åº¦ã€ã€‚æ¯å¤©åªè¦ 5 åˆ†é˜ã€‚</p>
      </div>
      <a class="link-back" href="index.html">
        â† å›åˆ°æ¯æ—¥ 1 åˆ†é˜ç·´ç¿’å¡
      </a>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" data-mode="tongue">
        <span class="emoji">ğŸ‘…</span><span>ç¹å£ä»¤</span>
      </button>
      <button class="tab-btn" data-mode="story">
        <span class="emoji">ğŸ“–</span><span>å°æ•…äº‹æœ—è®€</span>
      </button>
      <button class="tab-btn" data-mode="logic">
        <span class="emoji">ğŸ§ </span><span>é‚è¼¯å¥å‹</span>
      </button>
      <button class="tab-btn" data-mode="free">
        <span class="emoji">ğŸ™ï¸</span><span>è‡ªç”±èªªï¼‹è‡ªè©•</span>
      </button>
    </div>

    <!-- Main card -->
    <div class="card">
      <div class="label" id="mode-label">01 â€¢ ç¹å£ä»¤ç·´ç¿’</div>
      <p class="prompt-text" id="main-text"></p>
      <p class="mini-hint" id="hint-text"></p>

      <div class="btn-row">
        <button class="btn primary" id="btn-speak">
          ğŸ”Š ç”¨ TTS æ’­æ”¾
        </button>
        <button class="btn" id="btn-next">
          ğŸ² æ›ä¸€é¡Œ
        </button>
        <button class="btn ghost" id="btn-record">
          âºï¸ é–‹å§‹éŒ„éŸ³
        </button>
        <button class="btn ghost" id="btn-playback" disabled>
          â–¶ï¸ æ’­æ”¾å‰›å‰›çš„éŒ„éŸ³
        </button>
      </div>

      <textarea id="note-area" placeholder="é€™ä¸€é¡Œä½ æƒ³ç·´ä»€éº¼ï¼Ÿå¯ä»¥è¨˜ä¸‹ï¼šå¡ä½çš„åœ°æ–¹ã€æƒ³æ”¹é€²çš„é‡é»ã€é—œéµå¥å­ã€‚"></textarea>

      <div class="score-row" id="score-row">
        <div class="score-item">
          <label>
            <span>æ¸…æ™°åº¦</span>
            <span id="score-clarity-label">3</span>
          </label>
          <input type="range" min="1" max="5" value="3" id="score-clarity">
        </div>
        <div class="score-item">
          <label>
            <span>é‚è¼¯ / çµæ§‹</span>
            <span id="score-logic-label">3</span>
          </label>
          <input type="range" min="1" max="5" value="3" id="score-logic">
        </div>
        <div class="score-item">
          <label>
            <span>æº«åº¦ / æƒ…æ„Ÿ</span>
            <span id="score-warm-label">3</span>
          </label>
          <input type="range" min="1" max="5" value="3" id="score-warm">
        </div>
      </div>

      <div class="footer-note">
        å°æé†’ï¼šä¸ç”¨è¦æ±‚å®Œç¾ï¼Œæ¯å¤©æ¯”æ˜¨å¤©å¤šè§€å¯Ÿä¸€é»é»å°±å¥½ã€‚
      </div>
    </div>
  </div>

  <script>
    // === è³‡æ–™åº«ï¼šé¡Œç›®å€‘ ===
    const tongueTwisters = [
      "åƒè‘¡è„ä¸åè‘¡è„çš®ï¼Œä¸åƒè‘¡è„å€’åè‘¡è„çš®ã€‚",
      "é»‘åŒ–è‚¥æ®ç™¼ç™¼ç°ï¼Œç°åŒ–è‚¥æ®ç™¼ç™¼é»‘ã€‚",
      "æ±é‚Šä¾†äº†ä¸€éš»å¤§è€è™ï¼Œè¥¿é‚Šä¾†äº†ä¸€éš»å°è€è™ã€‚",
      "ç­ç­æ¬æ¬ç­ç­ç‰ˆï¼Œç¿»ç¿»ç‰ˆæœ¬ç…©ç…©ç…©ã€‚",
      "å”å”èªªæ›¸ï¼Œèªªçš„æ˜¯ä¸‰åæ¢å°çŸ³ç…ã€‚"
    ];

    const stories = [
      "ä»Šå¤©çš„ä½ åƒä¸€å€‹å°å°æƒ…ç·’åµæ¢ã€‚å›æƒ³ä»Šå¤©ç™¼ç”Ÿçš„ä¸€ä»¶å°äº‹ï¼šä¹Ÿè¨±æ˜¯å’Œå®¶äººçš„å°è©±ï¼Œä¹Ÿè¨±æ˜¯è‡ªå·±é»˜é»˜åœ¨æ„çš„ä¸€å¥è©±ã€‚è«‹ç”¨è‡ªå·±çš„è©±ï¼Œå¿µå‡ºé€™ä»¶äº‹çš„ã€Œé–‹é ­ã€éç¨‹ã€çµå°¾ã€ï¼Œåƒåœ¨è¬›ä¸€å€‹çŸ­çŸ­çš„æ•…äº‹ã€‚",
      "æƒ³åƒä½ åœ¨è·Ÿä¸€ä½å¾ˆé—œå¿ƒä½ ã€ä¹Ÿä¸æœƒæ‰“æ–·ä½ çš„äººèŠå¤©ã€‚è«‹ç”¨ä¸‰åˆ°äº”å¥è©±ï¼Œå¿µå‡ºã€Œä»Šå¤©æœ€è®“ä½ æ”¾ä¸ä¸‹çš„ä¸€ä»¶äº‹ã€ï¼Œä¸ç”¨åˆ†æå°éŒ¯ï¼Œåªæ˜¯æŠŠç•«é¢æè¿°æ¸…æ¥šã€‚",
      "é¸ä¸€å€‹ä½ å¾ˆå–œæ­¡çš„æ—¥å¸¸ç•«é¢ï¼šæ³¡å’–å•¡ã€æ•£æ­¥ã€ç•«ç•«ã€å¯«å­—ã€‚ç”¨ç¬¬ä¸€äººç¨±ï¼Œå¿µå‡ºé€™å€‹ç•«é¢çš„ç´°ç¯€ï¼šé¡è‰²ã€è²éŸ³ã€æ°£å‘³ï¼Œè®“è½çš„äººå¥½åƒä¹Ÿåœ¨ç¾å ´ã€‚"
    ];

    const logicPatterns = [
      "éæš´åŠ›æºé€šå¥å‹ï¼šã€ç•¶æˆ‘çœ‹åˆ° / è½åˆ° ______ æ™‚ï¼Œæˆ‘æ„Ÿåˆ° ______ï¼Œå› ç‚ºæˆ‘åœ¨ä¹ ______ï¼Œæˆ‘å¸Œæœ›å¯ä»¥ ______ã€‚ã€è«‹å¤§è²å¿µå‡ºä¸¦å¡«å…¥ä»Šå¤©çš„ä¸€å€‹æƒ…å¢ƒã€‚",
      "èªªæ˜è«‹æ±‚è€Œä¸æ˜¯å‘½ä»¤ï¼šã€ä½ å¯ä»¥å¹«æˆ‘ ______ å—ï¼Ÿå¦‚æœå¯ä»¥ï¼Œæˆ‘æœƒå¾ˆæ„Ÿè¬ï¼Œå› ç‚ºé€™æ¨£æˆ‘å°±èƒ½ ______ã€‚ã€é¸ä¸€ä»¶ä½ çœŸçš„æƒ³é–‹å£çš„äº‹ï¼Œå¿µä¸€æ¬¡çµ¦è‡ªå·±è½ã€‚",
      "æ•´ç†é‡é»å¥ï¼šç”¨ä¸€å¥è©±ï¼ŒæŠŠå‰›å‰›é‚£æ®µæ•…äº‹çš„é‡é»èªªå‡ºä¾†ã€‚ã€Œæ‰€ä»¥ï¼Œæˆ‘çœŸæ­£æƒ³èªªçš„æ˜¯ï¼š______ã€‚ã€"
    ];

    const freePrompts = [
      "è‡ªç”±èªª 60 ç§’ï¼šå›é¡§ä»Šå¤©ï¼Œä½ æœ€æƒ³è·Ÿæœªä¾†çš„è‡ªå·±èªªä»€éº¼ï¼ŸæŠŠå®ƒå¿µå‡ºä¾†ã€‚",
      "å°è‡ªå·±åšä¸€æ®µç°¡çŸ­çš„ã€æƒ…ç·’å ±å‘Šã€ï¼šæˆ‘ç¾åœ¨çš„ç‹€æ…‹æ˜¯ ______ï¼Œæˆ‘è¦ºå¾— ______ï¼Œæ¥ä¸‹ä¾†æˆ‘æƒ³ ______ã€‚",
      "å‡è¨­ä½ è¦éŒ„ä¸€æ®µè¨Šæ¯çµ¦ä¸€ä½å¾ˆåœ¨ä¹ä½ çš„äººï¼šä½ æœƒæ€éº¼æè¿°ä½ æœ€è¿‘çš„ç”Ÿæ´»ï¼Ÿ"
    ];

    const modeMap = {
      tongue: {
        label: "01 â€¢ ç¹å£ä»¤ç·´ç¿’",
        data: tongueTwisters,
        hint: "å…ˆè½ä¸€æ¬¡ï¼Œå†è‡ªå·±å¿µä¸‰éã€‚é€Ÿåº¦ä¸ç”¨å¿«ï¼Œå„ªå…ˆè®“å˜´å·´ç†Ÿæ‚‰é‚£äº›ç¹å£åˆå¥½ç¬‘çš„éŸ³ç¯€ã€‚"
      },
      story: {
        label: "02 â€¢ å°æ•…äº‹æœ—è®€",
        data: stories,
        hint: "æƒ³åƒä½ åœ¨è·Ÿä¸€å€‹æº«æŸ”çš„æœ‹å‹èªªè©±ã€‚è©¦è‘—æŠŠç•«é¢è¬›æ¸…æ¥šï¼Œè€Œä¸æ˜¯æ€¥è‘—çµ¦çµè«–ã€‚"
      },
      logic: {
        label: "03 â€¢ é‚è¼¯å¥å‹",
        data: logicPatterns,
        hint: "è·Ÿè‘—å¥å‹æ…¢æ…¢å¿µï¼Œä½ æ˜¯åœ¨å¹«å¤§è…¦ç·´ç¿’ï¼šå…ˆè§€å¯Ÿï¼Œå†èªªæ„Ÿå—ï¼Œæœ€å¾Œæ‰æ˜¯è«‹æ±‚ã€‚"
      },
      free: {
        label: "04 â€¢ è‡ªç”±èªªï¼‹è‡ªè©•",
        data: freePrompts,
        hint: "ä¸éœ€è¦è¯éº—ï¼Œåªè¦çœŸå¯¦ã€‚èªªå®Œå¾Œï¼Œç”¨ä¸‹é¢çš„ä¸‰å€‹åˆ»åº¦ï¼Œå¹«è‡ªå·±æ‰“å°å°çš„åˆ†æ•¸ã€‚"
      }
    };

    let currentMode = "tongue";
    let currentIndex = 0;

    const modeLabelEl = document.getElementById("mode-label");
    const mainTextEl = document.getElementById("main-text");
    const hintTextEl = document.getElementById("hint-text");
    const btnSpeak = document.getElementById("btn-speak");
    const btnNext = document.getElementById("btn-next");
    const btnRecord = document.getElementById("btn-record");
    const btnPlayback = document.getElementById("btn-playback");
    const noteArea = document.getElementById("note-area");

    const clarityRange = document.getElementById("score-clarity");
    const logicRange = document.getElementById("score-logic");
    const warmRange = document.getElementById("score-warm");
    const clarityLabel = document.getElementById("score-clarity-label");
    const logicLabel = document.getElementById("score-logic-label");
    const warmLabel = document.getElementById("score-warm-label");

    // === åˆå§‹åŒ– ===
    function renderCard() {
      const modeInfo = modeMap[currentMode];
      modeLabelEl.textContent = modeInfo.label;
      const list = modeInfo.data;
      currentIndex = (currentIndex + list.length) % list.length;
      mainTextEl.textContent = list[currentIndex];
      hintTextEl.textContent = modeInfo.hint;

      // è‡ªç”±èªªæ¨¡å¼ï¼Œé¼“å‹µå¤šå¯«ï¼Œé è¨­æ–‡å­—æ”¹ä¸€ä¸‹
      if (currentMode === "free") {
        noteArea.placeholder = "èªªå®Œå¾Œï¼Œå¯«ä¸‹ä½ è§€å¯Ÿåˆ°çš„ï¼š\nâ€¢ å“ªä¸€å¥ä½ è¦ºå¾—è¬›å¾—æœ€å¥½ï¼Ÿ\nâ€¢ å“ªå€‹åœ°æ–¹æƒ³ä¸‹æ¬¡èª¿æ•´ï¼Ÿ\nâ€¢ èªªå®Œé€™æ®µè©±ï¼Œä½ çš„èº«é«”æœ‰ä»€éº¼è®ŠåŒ–ï¼Ÿ";
      } else {
        noteArea.placeholder = "å¯ä»¥è¨˜ä¸‹ï¼šå¡ä½çš„åœ°æ–¹ã€æƒ³æ”¹é€²çš„é‡é»ã€æƒ³åˆ°çš„é—œéµå¥å­ã€‚";
      }
    }

    // åˆå§‹é¡¯ç¤º
    renderCard();

    // === Tab åˆ‡æ› ===
    document.querySelectorAll(".tab-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentMode = btn.dataset.mode;
        currentIndex = 0;
        renderCard();
      });
    });

    // === TTS æ’­æ”¾ ===
    function speak(text) {
      if (!("speechSynthesis" in window)) {
        alert("é€™å€‹ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³æœ—è®€ï¼ˆSpeech Synthesisï¼‰ï¼Œå¯ä»¥æ”¹ç”¨æ‰‹æ©Ÿ / Chrome è©¦è©¦ã€‚");
        return;
      }
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = "zh-TW";
      utter.rate = 1.0;
      utter.pitch = 1.0;
      speechSynthesis.cancel();
      speechSynthesis.speak(utter);
    }

    btnSpeak.addEventListener("click", () => {
      speak(mainTextEl.textContent);
    });

    // === æ›é¡Œç›® ===
    btnNext.addEventListener("click", () => {
      const list = modeMap[currentMode].data;
      currentIndex = (currentIndex + 1) % list.length;
      renderCard();
    });

    // === è‡ªæˆ‘è©•åˆ†ï¼ˆåªæ˜¯æ›´æ–°æ•¸å­—ï¼Œå¥½ç©ï¼‹è¦ºå¯Ÿï¼‰ ===
    function bindRange(rangeEl, labelEl) {
      labelEl.textContent = rangeEl.value;
      rangeEl.addEventListener("input", () => {
        labelEl.textContent = rangeEl.value;
      });
    }

    bindRange(clarityRange, clarityLabel);
    bindRange(logicRange, logicLabel);
    bindRange(warmRange, warmLabel);

    // === éŒ„éŸ³åŠŸèƒ½ï¼ˆç°¡å–®ç‰ˆï¼šéŒ„ä¸‹ä¾†ã€è‡ªå·±è½ï¼‰ ===
    let mediaRecorder = null;
    let recordedChunks = [];

    async function toggleRecording() {
      if (mediaRecorder && mediaRecorder.state === "recording") {
        mediaRecorder.stop();
        btnRecord.textContent = "âºï¸ é–‹å§‹éŒ„éŸ³";
        return;
      }

      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert("é€™å€‹ç€è¦½å™¨ä¸æ”¯æ´éŒ„éŸ³ã€‚å¯ä»¥æ”¹ç”¨æ‰‹æ©Ÿä¸Šçš„ Chrome / Safari è©¦è©¦ã€‚");
        return;
      }

      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        recordedChunks = [];

        mediaRecorder.ondataavailable = (e) => {
          if (e.data.size > 0) recordedChunks.push(e.data);
        };

        mediaRecorder.onstop = () => {
          const blob = new Blob(recordedChunks, { type: "audio/webm" });
          const url = URL.createObjectURL(blob);
          btnPlayback.disabled = false;
          btnPlayback.dataset.audioUrl = url;
        };

        mediaRecorder.start();
        btnRecord.textContent = "â¹ï¸ åœæ­¢éŒ„éŸ³";
        btnPlayback.disabled = true;
      } catch (err) {
        console.error(err);
        alert("ç„¡æ³•å•Ÿå‹•éº¥å…‹é¢¨ï¼Œè«‹æª¢æŸ¥æ¬Šé™è¨­å®šã€‚");
      }
    }

    btnRecord.addEventListener("click", toggleRecording);

    btnPlayback.addEventListener("click", () => {
      const url = btnPlayback.dataset.audioUrl;
      if (!url) return;
      const audio = new Audio(url);
      audio.play();
    });
  </script>
</body>
</html>
